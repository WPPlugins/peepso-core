!function(a,b,c){b.comment=new(function(a,b){function c(){this.init()}return b.npm.objectAssign(c.prototype,{init:function(){this.ajax={},a(a.proxy(function(){var a=window.location.hash||"",b=/[#&]comment=(\d+)\.(\d+)(?:\.(\d+)(?:\.(\d+))?)?/,c=a.match(b);c&&c[2]&&this.reveal(c[1],c[2],c[3],c[4])},this))},add:function(){},edit:function(){},reply:function(b,c,d,e){var f,g,h,i,j,k="#comment-item-"+c;f=d?a(d).closest(k):a(k),g=f.find(".actaction-reply"),j=g.closest(".ps-comment").hasClass("ps-comment-nested"),j?(h=g.closest(".ps-comment").children(".ps-comment-reply"),i=h.find("textarea")):(h=g.closest(".ps-comment-item").next(".ps-comment-nested").children(".ps-comment-reply"),i=h.find("textarea")),h.not(":visible")&&h.show(),i.focus(),e=e||{},ps_observer.apply_filters("comment.reply",i,a.extend({},e,{act_id:b,post_id:c}))},show_previous:function(c,d){function e(d){var e=f.children(".cstream-comment:first");h.removeClass("hidden"),b.postJson("activity.show_previous_comments",{act_id:c,uid:peepsodata.currentuserid,first:e.data("comment-id")},function(b){h.addClass("hidden"),e.before(b.data.html),b.data.comments_remain>0?g.find("a").html(b.data.comments_remain_caption):g.remove(),a(document).trigger("ps_comment_added"),d()})}var f,g,h,i=".ps-js-comment-container--"+c;return f=d?a(d).closest(i):a(i),g=f.find(".ps-js-comment-more"),h=g.find(".ps-js-loading"),a.Deferred(function(a){e(function(){a.resolve()})})},show_all:function(c){function d(h){var i=e.children(".cstream-comment:first");g.removeClass("hidden"),b.postJson("activity.show_previous_comments",{act_id:c,uid:peepsodata.currentuserid,all:1,first:i.data("comment-id")},function(b){g.addClass("hidden"),i.before(b.data.html),b.data.comments_remain>0?(f.find("a").html(b.data.comments_remain_caption),d(h)):(f.remove(),a(document).trigger("ps_comment_added"),h())})}var e=a(".ps-js-comment-container--"+c),f=e.children(".ps-js-comment-more"),g=f.find(".ps-js-loading");return a.Deferred(function(a){d(function(){a.resolve()})})},reveal_comment:function(b,c){return a.Deferred(a.proxy(function(d){a("#comment-item-"+c).length?d.resolve():this.show_all(b).done(a.proxy(function(){d.resolve()},this))},this))},reveal:function(b,c,d,e){function f(b){var c=b.find("a.ps-comment-user").eq(0).css("color"),d=b.offset().top-(a(window).height()-b.outerHeight())/2;b.css({backgroundColor:c}),b.css({transition:"background-color 2s ease"}),a("html, body").delay(50).animate({scrollTop:d},500,function(){b.css({backgroundColor:""})})}this.reveal_comment(b,c).done(a.proxy(function(){var b;e?this.reveal_comment(d,e).done(function(){b=a("#comment-item-"+e),f(b)}):(b=a("#comment-item-"+c),f(b))},this))}}),c}(a,b))}(jQuery,peepso);