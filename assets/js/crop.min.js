!function(a,b,c,d){var e=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i,f=!e.test(navigator.userAgent),g=d(a,b,c,f);ps_crop={},ps_crop.init=function(b){var c,d;c=a(b.elem),d=c.data("ps-crop"),d&&d.destroy(),d=new g(b),c.data("ps-crop",d)},ps_crop.detach=function(b){var c;b=a(b),c=b.data("ps-crop"),c&&c.detach()}}(jQuery||$,Hammer,peepso,function(a,b,c,d){function e(b){this.$elem=a(b.elem),this.$wrapper=a('<div class="ps-crop-wrapper" />'),this.$cropper=a('<div class="ps-crop-box" />'),this.$wnd=a(window),this.change=b.change||a.noop,this.attach()}return e.prototype.attach=function(){this.$elem.wrap(this.$wrapper),this.$cropper.insertAfter(this.$elem),this.$wrapper=this.$elem.parent(),this.hammertime||(this.hammertime=new b(this.$cropper[0]),this.hammertime.on("pan panstart panend",a.proxy(function(a){a.srcEvent.stopPropagation(),a.srcEvent.preventDefault(),"panstart"===a.type?(this.disableDesktopEvents(),this.onTouch(a)):"pan"===a.type?this.onDragOrResize(a):(this.onRelease(a),this.enableDesktopEvents())},this))),this.enableDesktopEvents()},e.prototype.detach=function(){this.$cropper.detach(),this.$elem.unwrap()},e.prototype.measure=function(){var a=this.$elem,b=this.$wrapper[0],c=this.$cropper.position();return{imageWidth:a.width(),imageHeight:a.height(),wrapperTop:b.scrollTop,wrapperLeft:b.scrollLeft,wrapperWidth:this.$wrapper.width(),wrapperHeight:this.$wrapper.height(),cropperTop:c.top+b.scrollTop,cropperLeft:c.left+b.scrollLeft,cropperWidth:this.$cropper.outerWidth(),cropperHeight:this.$cropper.outerHeight()}},e.prototype.getPointerPosition=function(a,b){var c=this.$cropper.offset();return{top:b-c.top+this.$wnd.scrollTop(),left:a-c.left+this.$wnd.scrollLeft()}},e.prototype.getResizeDirection=function(a){var b=d?15:20,c=this.getPointerPosition(a.center.x,a.center.y),e=this.measurements,f="";return c.top<b?f+="n":c.top>e.cropperHeight-b&&(f+="s"),c.left<b?f+="w":c.left>e.cropperWidth-b&&(f+="e"),f},e.prototype.getSelection=function(){return{x:this.measurements.cropperLeft,y:this.measurements.cropperTop,width:this.measurements.cropperWidth,height:this.measurements.cropperHeight}},e.prototype.onTouch=function(a){this.released=!1,this.measurements=this.measure(),this.direction=this.getResizeDirection(a)},e.prototype.onDragOrResize=_.throttle(function(a){this.direction?this.onResize(a):this.onDrag(a)},d?10:100),e.prototype.onDrag=function(a){var b,c=this.measurements,d=a.deltaY,e=a.deltaX;this.released||(e=Math.min(e,c.imageWidth-c.cropperWidth-c.cropperLeft),e=Math.max(e,0-c.cropperLeft),d=Math.min(d,c.imageHeight-c.cropperHeight-c.cropperTop),d=Math.max(d,0-c.cropperTop),b="translate3d("+e+"px, "+d+"px, 0)",this.$cropper.css({webkitTransform:b,mozTransform:b,transform:b}))},e.prototype.onResize=function(a){var b=this.direction,c=this.measurements,d={};this.released||(b.match(/n/)?(d.top="auto",d.bottom=c.wrapperHeight-c.cropperTop-c.cropperHeight,d.height=c.cropperHeight-a.deltaY):b.match(/s/)&&(d.bottom="auto",d.top=c.cropperTop,d.height=c.cropperHeight+a.deltaY),b.match(/e/)?(d.right="auto",d.left=c.cropperLeft,d.width=c.cropperWidth+a.deltaX):b.match(/w/)&&(d.left="auto",d.right=c.wrapperWidth-c.cropperLeft-c.cropperWidth,d.width=c.cropperWidth-a.deltaX),d.width=d.height=Math.max(d.width||0,d.height||0,64),b.match(/n/)?d.height=Math.min(d.height,c.wrapperHeight-d.bottom):b.match(/s/)?d.height=Math.min(d.height,c.imageHeight-d.top):"auto"!==this.$cropper[0].style.top?d.height=Math.min(d.height,c.imageHeight-parseInt(this.$cropper.css("top"))):d.height=Math.min(d.height,c.wrapperHeight-parseInt(this.$cropper.css("bottom"))),b.match(/e/)?d.width=Math.min(d.width,c.imageWidth-d.left):b.match(/w/)?d.width=Math.min(d.width,c.wrapperWidth-d.right):"auto"!==this.$cropper[0].style.left?d.width=Math.min(d.width,c.imageWidth-parseInt(this.$cropper.css("left"))):d.width=Math.min(d.width,c.wrapperWidth-parseInt(this.$cropper.css("right"))),d.width=d.height=Math.min(d.width,d.height),this.$cropper.css(d))},e.prototype.onRelease=function(a){var b=this.$cropper.position(),c=this.measurements,d={top:Math.max(b.top+c.wrapperTop,0),left:Math.max(b.left+c.wrapperLeft,0),right:"",bottom:"",webkitTransform:"",mozTransform:"",transform:""};this.released=!0,this.$cropper.css(d),this.measurements=this.measure(),this.change(this.getSelection())},e.prototype.destroy=function(){this.detach(),this.$elem=null,this.$wrapper=null,this.$cropper=null,this.$wnd=null,this.hammertime=null},e.prototype.enableDesktopEvents=function(){d&&this.$cropper.on("mousemove.ps-crop",a.proxy(this.onMouseMove,this))},e.prototype.disableDesktopEvents=function(){d&&this.$cropper.off("mousemove.ps-crop")},e.prototype.onMouseMove=function(b){var c=a(b.target).parent().offset(),d=b.pageX-c.left,e=b.pageY-c.top,f=15,g="",h=this.measure();e<h.cropperTop-h.wrapperTop+f?g+="n":e>h.cropperTop-h.wrapperTop+h.cropperHeight-f&&(g+="s"),d<h.cropperLeft-h.wrapperLeft+f?g+="w":d>h.cropperLeft-h.wrapperLeft+h.cropperWidth-f&&(g+="e"),this.$cropper.css({cursor:g?g+"-resize":""})},e});