!function(a,b){var c=function(a,b){function c(){this.__constructor.apply(this,arguments)}return peepso.npm.objectAssign(c.prototype,PsObserver.prototype,{__constructor:function(a,c){var d=peepso.template(psdata_postbox.template);this.$el=b(a).html(d),this.$text=this.$el.find("textarea").ps_autosize(),this.$loading=this.$el.find(".ps-postbox-loading"),this.$btns=this.$el.find(".ps-postbox-action"),this.$btnCancel=this.$btns.find(".ps-button-cancel"),this.$btnSubmit=this.$btns.find(".ps-button-action"),this.$charCounter=this.$el.find(".ps-postbox-charcount"),this.$tabRoot=this.$el.find("div.ps-postbox-tab-root"),this.$tabContext=this.$el.find("nav.ps-postbox-tab"),this.$addons=this.$el.find(".ps-postbox-addons"),this.opts=b.extend({maxChars:+psdata_postbox.max_chars||4e3,fetch:!1,cancel:!1,submit:!1},c||{}),this.init()},init:function(){this.$text.val(""),this.updateButtonVisibility(),this.updateCharCounter(),this.add_action("refresh",this.refresh,10,1,this),this.$tabContext.find("#privacy-tab").remove(),this.$tabContext.find("#status-post").remove(),ps_observer.do_action("postbox_init",this),this.fetch().done(function(){this.$text.on("focus.ps-postbox",b.proxy(this.onFocus,this)),this.$text.on("input.ps-postbox",b.proxy(this.onInput,this)),this.$btnSubmit.on("click.ps-postbox",b.proxy(this.onSubmit,this)),this.$btnCancel.on("click.ps-postbox",b.proxy(this.onCancel,this)),this.$tabRoot.on("click.ps-postbox","li[data-tab]",b.proxy(this.onTabChange,this))})},fetch:function(){return b.Deferred(b.proxy(function(a){"function"==typeof this.opts.fetch?(this.$btns.hide(),this.$loading.show(),this.opts.fetch(this,b.proxy(function(){this.$loading.hide(),this.$btns.css("display","flex"),a.resolveWith(this)},this))):a.resolveWith(this)},this))},update:function(a){this.$text.val(a.content||"").trigger("input"),this.updateButtonVisibility(),this.updateCharCounter(),this.do_action("update",a),ps_observer.do_action("postbox_update",this,a)},reset:function(){this.$text.val(""),this.updateButtonVisibility(),this.updateCharCounter(),this.do_action("reset"),ps_observer.do_action("postbox_reset",this)},refresh:function(){this.renderAddons(),this.updateButtonVisibility(),this.updateCharCounter()},_getData:function(){return{content:this.$text.val()}},getData:function(){var a=this._getData();return a=this.apply_filters("data",a),a=ps_observer.apply_filters("postbox_data",a,this)},tabChange:function(a){var b=this.$tabRoot.find("li[data-tab]"),c=b.filter('[data-tab="'+a+'"]');c.length&&(b.not(c).removeClass("active"),c.addClass("active"),this.currentTab=a)},getActiveTab:function(){return this.currentTab||(this.currentTab=this.$tabRoot.find("li.active").data("tab")),this.currentTab},validate:function(){var a=this._getData(),c=b.trim(a.content),d=!!c;return this.apply_filters("data_validate",d,a)},submit:function(){"function"==typeof this.opts.submit&&this.validate()&&(this.$btns.hide(),this.$loading.show(),this.opts.submit(this,this.getData(),b.proxy(function(){this.$loading.hide(),this.$btns.css("display","flex")},this)))},cancel:function(){this.reset(),this.$tabContext.hide(),this.$tabRoot.show(),"function"==typeof this.opts.cancel&&this.opts.cancel(this)},updateCharCounter:_.throttle(function(){var a=this.$text.val().length,b=Math.max(0,this.opts.maxChars-a);this.$charCounter.html(b)},250),updateButtonVisibility:_.throttle(function(){this.validate()?this.$btnSubmit.show():this.$btnSubmit.hide()},250),renderAddons:_.throttle(function(){var a=this.apply_filters("render_addons",[]),b=a.join(" and ");b&&(b="&mdash; "+b),this.$addons.html(b)},250),destroy:function(){this.$el.empty()},onFocus:function(){this.$tabRoot.hide(),this.$tabContext.show()},onInput:function(){this.updateButtonVisibility(),this.updateCharCounter()},onCancel:function(){this.cancel()},onSubmit:function(){this.submit()},onTabChange:function(a){var c=b(a.currentTarget).data("tab");this.tabChange(c)}}),c}("PsPostbox",a);a.fn.ps_postbox=function(b,d){return this.each(function(){var e,f=a(this),g=f.data("ps-postbox");g&&"string"==typeof b?(g[b].call(g,d),"destroy"===b&&f.removeData("ps-postbox")):g||(e=b||{},g=new c(f,e),f.data("ps-postbox",g))})}}(jQuery);