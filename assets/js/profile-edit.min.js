function PsProfileAvatar(){this.g_coords={x:0,y:0,x2:0,y2:0,w:0,h:0}}var profileavatar=new PsProfileAvatar;PsProfileAvatar.prototype.setCoords=function(a){this.g_coords.x=a.x,this.g_coords.y=a.y,this.g_coords.x2=a.x2,this.g_coords.y2=a.y2,this.g_coords.w=a.w,this.g_coords.h=a.h},PsProfileAvatar.prototype.saveThumbnail=function(){var a,b=this,c=+jQuery("#cWindowContent [name=is_tmp]").val()?1:0,d=jQuery("#cWindowContent .large-profile-pic"),e=d.width(),f=d.height(),g=d[0].naturalWidth||e,h=d[0].naturalHeight||f,a=g/e,i=1500;(g>i||h>i)&&(g>h?(h=i/g*h,g=i):(g=i/h*g,h=i)),a=g/e,req={u:peepsodata.userid,x:Math.round(this.g_coords.x*a),y:Math.round(this.g_coords.y*a),x2:Math.round(this.g_coords.x2*a),y2:Math.round(this.g_coords.y2*a),width:g,height:h,tmp:c,_wpnonce:jQuery("#_photononce").val()},$PeepSo.get("profile.crop",req,function(a){var d="?"+Math.floor(1e4*Math.random()),e=jQuery("#cWindowContent .large-profile-pic");ps_crop.detach(e),a.success&&(c?jQuery("#cWindowContent .js-focus-avatar img").attr("src",a.data.image_url+d):b.refreshThumbnail())}),jQuery("#cWindowContent .update-thumbnail").show(),jQuery("#cWindowContent .update-thumbnail-save").hide(),jQuery("#cWindowContent .update-thumbnail-guide").hide()},PsProfileAvatar.prototype.imgSelect=function(a,b){this.g_coords.x=b.x1,this.g_coords.y=b.y1,this.g_coords.x2=b.x2,this.g_coords.y2=b.y2,this.g_coords.w=b.width,this.g_coords.h=b.height},PsProfileAvatar.prototype.updateThumbnail=function(){var a=jQuery("#cWindowContent .large-profile-pic");ps_crop.init({elem:a,change:jQuery.proxy(function(b){this.imgSelect(a[0],{x1:b.x,y1:b.y,x2:b.x+b.width,y2:b.y+b.height,width:b.width,height:b.height})},this)}),jQuery("#cWindowContent .update-thumbnail").hide(),jQuery("#cWindowContent .update-thumbnail-save").show(),jQuery("#cWindowContent .update-thumbnail-guide").show()},PsProfileAvatar.prototype.refreshThumbnail=function(){var a=Math.random(),b=jQuery("#cWindowContent .thumbnail-profile-pic").attr("src");jQuery("#cWindowContent .thumbnail-profile-pic").attr("src",b+"?"+a);var b=jQuery(".js-focus-avatar img").attr("src"),c=b.split("?",1);jQuery(".js-focus-avatar img").attr("src",c+"?"+a);var d=document.getElementById("ps-profile-avatar-iframe");d.innerHTML=d.innerHTML;var e=jQuery("#ps-profile-avatar-iframe"),b=e.attr("src");if(e.attr("src",b),-1!==b.indexOf("/peepso/assets/images/user")){var f=jQuery(".js-focus-avatar img").attr("src");f.replace("-full.jpg",".jpg"),b=f}var g=jQuery("img.cavatar");jQuery.each(g,function(b,c){var d=jQuery(c).data("author");if(d=parseInt(d),d===peepsodata.currentuserid){var e=jQuery(c).attr("src");e.indexOf("?")>0&&(e=e.split("?",1)),jQuery(c).attr("src",e+"?"+a)}})},PsProfileAvatar.prototype.cleanup_after_imgareaslect=function(){jQuery(".imgareaselect-selection").parent().hide(),jQuery(".imgareaselect-outer").hide()},jQuery(document).ready(function(a){ps_observer.add_filter("pswindow_close",function(){profileavatar.cleanup_after_imgareaslect()})});