function PsProfile(){this.cover={},this.cover.x_position_percent=0,this.cover.y_position_percent=0,this.$cover_ct=jQuery(".js-focus-cover"),this.$cover_image=jQuery("img#"+peepsodata.userid),this.initial_cover_position=this.$cover_image.attr("style"),this.avatar_use_gravatar=!1}var profile=new PsProfile;PsProfile.prototype.init=function(){var a=jQuery(".js-collapse-about-btn");0!==a.length&&a.on("click",function(a){a.preventDefault();var b=jQuery(".js-collapse-about");"none"===b.css("display")?b.show():b.hide()}),jQuery(".js-focus-cover").hover(function(){!1===pswindow.is_visible&&jQuery(".js-focus-change-cover").show()},function(){jQuery(".js-focus-change-cover").hide()}),jQuery(".ps-tab__bar").unbind("click");var b=this;this.$cover_image.one("load",function(){b.fix_horizontal_padding()}).each(function(){this.complete&&jQuery(this).load()}),jQuery(window).on("resize.focus-image",jQuery.proxy(this.fix_horizontal_padding_debounced,this));var c=jQuery(".ps-page--preferences");c.length&&(c.find("input[type=checkbox]").on("click.savepref",profile.save_preference),c.find("select").on("change",profile.save_preference),c.find(".ps-dropdown input[type=hidden]").on("change",profile.save_preference),c.find(".ps-list-alerts-check").find("input[type=checkbox]").off("click.savepref").on("click.savepref",profile.save_notification))},PsProfile.prototype.activate_tab=function(a,b,c){return a.preventDefault(),jQuery(a.target).addClass("active").siblings("[data-toggle=tab]").removeClass("active"),jQuery(c).hide(),jQuery(b).show(),!1},PsProfile.prototype.new_like=function(){return peepso.postJson("profile.like",{user_id:peepsodata.userid},function(a){a.success?jQuery(".profile-social.profile-interactions").html(a.data.html):psmessage.show("",a.errors[0]).fade_out(psmessage.fade_time)}),!1},PsProfile.prototype.unblock_user=function(a,b){if(!this.unblocking_user){b&&(b=jQuery(b),b.find("img").css("display","inline"));var c={uid:peepsodata.currentuserid,user_id:a};this.unblocking_user=!0,$PeepSo.postJson("activity.unblockuser",c,jQuery.proxy(function(b){this.unblocking_user=!1,b.success&&(jQuery(".ps-js-focus--"+a).find(".ps-focus-actions, .ps-focus-actions-mobile").html(b.data.actions),psmessage.show(b.data.header,b.data.message,psmessage.fade_time))},this))}},PsProfile.prototype.report_user=function(){var a=jQuery("#activity-report-title").html(),b=jQuery("#activity-report-content").html();b=b.replace("{post-content}","Profile"),b=b.replace("{post-id}",peepsodata.userid+""),ps_observer.add_filter("activity_report_action",function(a){return"profile.report"},10,1),actions=jQuery("#activity-report-actions").html(),pswindow.show(a,b).set_actions(actions).refresh(),jQuery("#ps-window").one("pswindow.hidden",function(){ps_observer.remove_filter("activity_report_action",function(a){return"profile.report"},10)}),jQuery(window).one("report.submitted",function(a,b){pswindow.show("Profile Reported",b.notices[0])})},PsProfile.prototype.confirm_remove_cover_photo=function(){var a=jQuery("#delete-confirmation #delete-title").html(),b=jQuery("#delete-confirmation #delete-content").html();pswindow.show(a,b)},PsProfile.prototype.remove_cover_photo=function(a){var b={uid:peepsodata.currentuserid,user_id:a,_wpnonce:jQuery("#_covernonce").val()};$PeepSo.postJson("profile.remove_cover_photo",b,function(a){a.success&&window.location.reload()})},PsProfile.prototype.reposition_cover=function(){jQuery(".js-focus-gradient",".js-focus-cover").hide(),jQuery(".js-focus-change-cover > a",".js-focus-cover").hide(),jQuery(".reposition-cover-actions",".js-focus-cover").show(),jQuery(".js-focus-cover").addClass("ps-focus-cover-edit");var a=this,b=jQuery(".js-focus-cover").height()-jQuery("img#"+peepsodata.userid).height(),c=jQuery(".js-focus-cover").width()-jQuery("img#"+peepsodata.userid).width();jQuery("img#"+peepsodata.userid).draggable({cursor:"move",drag:function(a,d){d.position.top<b&&(d.position.top=b),d.position.top>0&&(d.position.top=0),d.position.left<c&&(d.position.left=c),d.position.left>0&&(d.position.left=0)},stop:function(b,c){var d=jQuery("img#"+peepsodata.userid),e=d.closest(".js-focus-cover"),f=100*c.position.top/e.height();f=Math.round(1e4*f)/1e4,y=100*c.position.left/e.width(),y=Math.round(1e4*y)/1e4,a.cover.x_position_percent=f,a.cover.y_position_percent=y,d.css("top",f+"%"),d.css("left",y+"%")}})},PsProfile.prototype.cancel_reposition_cover=function(){jQuery(".js-focus-gradient",".js-focus-cover").show(),jQuery(".js-focus-change-cover > a",".js-focus-cover").show(),jQuery(".reposition-cover-actions",".js-focus-cover").hide(),jQuery(".js-focus-cover").removeClass("ps-focus-cover-edit"),jQuery("img#"+peepsodata.userid).attr("style",this.initial_cover_position),jQuery("img#"+peepsodata.userid).draggable("destroy")},PsProfile.prototype.save_reposition_cover=function(){var a={user_id:peepsodata.userid,x:this.cover.x_position_percent,y:this.cover.y_position_percent,_wpnonce:jQuery("#_photononce").val()},b=this;jQuery(".reposition-cover-actions",".js-focus-cover").hide(),jQuery(".ps-reposition-loading",".js-focus-cover").show(),jQuery(".js-focus-cover").removeClass("ps-focus-cover-edit"),$PeepSo.postJson("profile.reposition_cover",a,function(a){jQuery(".ps-reposition-loading",".js-focus-cover").hide(),b.initial_cover_position=jQuery("img#"+peepsodata.userid).attr("style"),b.cancel_reposition_cover()})},PsProfile.prototype.confirm_remove_avatar=function(){var a=jQuery("#delete-confirmation #delete-title").html(),b=jQuery("#delete-confirmation #delete-content").html();pswindow.show(a,b)},PsProfile.prototype.remove_avatar=function(a){var b={uid:peepsodata.currentuserid,user_id:a,_wpnonce:jQuery("#_photononce").val()};$PeepSo.postJson("profile.remove_avatar",b,function(a){a.success&&window.location.reload()})},PsProfile.prototype.delete_profile=function(){var a=jQuery("#profile-delete-title").html(),b=jQuery("#profile-delete-content").html();pswindow.show(a,b)},PsProfile.prototype.delete_profile_action=function(){$req={};var a={uid:peepsodata.currentuserid};$PeepSo.postJson("profile.delete_profile",a,function(a){a.success?window.location=a.data.url:psmessage.show("",a.errors[0]).fade_out(psmessage.fade_time)})},PsProfile.prototype.show_avatar_dialog=function(){jQuery(".ps-js-error").html("");var a=jQuery("#dialog-upload-avatar"),b=a.find("#dialog-upload-avatar-title").html(),c=a.find("#dialog-upload-avatar-content").html(),d=a.find(".dialog-action").html(),e=pswindow.show(b,c).set_actions(d),f=e.$container.find(".ps-dialog");f.addClass("ps-dialog-wide"),ps_observer.add_filter("pswindow_close",function(){f.removeClass("ps-dialog-wide")},10,1),this.init_avatar_fileupload(),jQuery("#ps-window").on("pswindow.hidden",function(){jQuery(".upload-avatar .fileupload:visible").fileupload("destroy")})},PsProfile.prototype.init_avatar_fileupload=function(){var a=this;jQuery(".upload-avatar .fileupload:visible").fileupload({formData:{user_id:peepsodata.userid,_wpnonce:jQuery("#_photononce").val()},dataType:"json",url:peepsodata.ajaxurl_legacy+"profile.upload_avatar?avatar",add:function(a,b){var c=/(\.|\/)(jpe?g|png)$/i;if(b.files[0].type.length&&!c.test(b.files[0].type)){var d=jQuery("#profile-avatar-error-filetype").text();jQuery(".ps-js-error").html(d)}else if(parseInt(b.files[0].size)>peepsodata.upload_size){var e=jQuery("#profile-avatar-error-filesize").text();jQuery(".ps-js-error").html(e)}else jQuery("#ps-window .ps-loading-image").show(),jQuery("#ps-window .show-avatar, #ps-window .show-thumbnail, #ps-window .upload-avatar").hide(),jQuery(".ps-js-error").hide(),pswindow.refresh(),b.submit()},done:function(b,c){var d=c.result;if(d.success){var e=jQuery("#dialog-upload-avatar-content",jQuery(d.data.html)),f=jQuery("#dialog-upload-avatar .dialog-action").html(),g="?"+Math.random();jQuery(".js-focus-avatar img",e).attr("src",d.data.image_url+g),jQuery(".imagePreview img",e).attr("src",d.data.orig_image_url+g),jQuery(".imagePreview",e).after('<input type="hidden" name="is_tmp" value="1"/>'),jQuery(".ps-js-has-avatar",e).show(),jQuery(".ps-js-no-avatar",e).hide(),pswindow.set_content(e),pswindow.set_actions(f),jQuery("#imagePreview img").one("load",function(){pswindow.refresh()}),a.init_avatar_fileupload(),jQuery("#ps-window button[name=rep_submit]").removeAttr("disabled").addClass("ps-btn-primary"),a.invalid_avatar_upload=!1,a.avatar_use_gravatar=!1}else jQuery("#ps-window .show-avatar, #ps-window .show-thumbnail, #ps-window .upload-avatar").show(),jQuery(".ps-js-error").html(d.errors).show(),jQuery("#ps-window .ps-loading-image").hide(),jQuery("#ps-window button[name=rep_submit]").attr("disabled","disabled").removeClass("ps-btn-primary"),a.invalid_avatar_upload=!0}})},PsProfile.prototype.confirm_avatar=function(a){var b,c;this.invalid_avatar_upload||(b=this.confirm_avatar,b._loading||(b._loading=!0,a&&(a=jQuery(a),a.attr("disabled","disabled")),c={user_id:peepsodata.userid,use_gravatar:this.avatar_use_gravatar?1:0,_wpnonce:jQuery("#_photononce").val()},peepso.postJson("profile.confirm_avatar",c,function(c){if(c&&c.success)return void window.location.reload();b._loading=!1,a&&a.removeAttr("disabled")})))},PsProfile.prototype.show_cover_dialog=function(){jQuery(".ps-js-error").html("");var a=jQuery("#dialog-upload-cover"),b=a.find("#dialog-upload-cover-title").html(),c=a.find("#dialog-upload-cover-content").html();pswindow.show(b,c),this.init_cover_fileupload(),jQuery("#ps-window").on("pswindow.hidden",function(){jQuery(".upload-cover .fileupload:visible").fileupload("destroy")})},PsProfile.prototype.init_cover_fileupload=function(){var a=this;jQuery(".upload-cover .fileupload:visible").fileupload({formData:{user_id:peepsodata.userid,_wpnonce:jQuery("#_photononce").val()},dataType:"json",url:peepsodata.ajaxurl_legacy+"profile.upload_cover?cover",add:function(a,b){var c=/(\.|\/)(jpe?g|png)$/i;if(b.files[0].type.length&&!c.test(b.files[0].type)){var d=jQuery("#profile-cover-error-filetype").text();jQuery(".ps-js-error").html(d)}else if(parseInt(b.files[0].size)>peepsodata.upload_size){var e=jQuery("#profile-cover-error-filesize").text();jQuery(".ps-js-error").html(e)}else jQuery("#ps-window .ps-loading-image").show(),jQuery("#ps-window .upload-cover").hide(),b.submit()},done:function(b,c){var d=c.result;jQuery("#ps-window .ps-loading-image").hide(),jQuery("#ps-window .upload-cover").show(),d.success?(jQuery(".cover-image").attr("src",d.data.image_url+"?"+Math.random()).css("top","0").css("left","0").removeClass("default").addClass("has-cover"),jQuery(".ps-focus-image-mobile").attr("style","background:url("+d.data.image_url+"?"+Math.random()+") no-repeat center center;"),pswindow.fade_out("slow"),jQuery("#profile-reposition-cover").show(),jQuery("#dialog-upload-cover-content").html(d.data.html),pswindow.set_content(jQuery("#dialog-upload-cover-content",d.data.html).html()),a.fix_horizontal_padding_debounced(),a.init_cover_fileupload()):jQuery(".ps-js-error").html(d.errors)}})},PsProfile.prototype.fix_horizontal_padding=function(){var a,b;this.$cover_image.css({height:"auto",width:"100%",minWidth:"100%",maxWidth:"100%"}),a=.375*this.$cover_ct.width(),a=Math.max(a,this.$cover_ct.height()),b=this.$cover_image.height(),b<a&&this.$cover_image.css({height:a,width:"auto",minWidth:"100%",maxWidth:"none"}),this.initial_cover_position=this.$cover_image.attr("style")},PsProfile.prototype.fix_horizontal_padding_debounced=_.debounce(function(){this.fix_horizontal_padding()},300),PsProfile.prototype.edit_field=function(a){var b,c=jQuery(a),d=c.closest(".ps-list-info-content"),e=d.find("input[type=text],input[type=checkbox],input[type=radio],textarea,select").eq(0),f=(e.attr("type")||"").toLowerCase();return d.find(".ps-list-info-content-text").hide(),d.find(".ps-list-info-content-form").show(),d.find(".ps-list-info-content-error").hide(),d.find(".ps-js-validation").removeClass("ps-alert-danger"),"checkbox"===f?(e=d.find("input[type=checkbox]:checked"),b=e.map(function(){return this.value}),b=jQuery.makeArray(b).join(","),d.data("original-value",b)):"radio"===f?(e=d.find("input[type=radio]:checked"),d.data("original-value",e.val())):e.hasClass("datepicker")?(d.data("original-value",e.data("value")),d.data("original-formatted",e.val())):d.data("original-value",e.val()),!1},PsProfile.prototype.cancel_field=function(a){var b,c,d=jQuery(a),e=d.closest(".ps-list-info-content"),f=e.find("input[type=text],input[type=checkbox],input[type=radio],textarea,select").eq(0),g=(f.attr("type")||"").toLowerCase(),h=f.data("id");return e.find(".ps-list-info-content-form").hide(),e.find(".ps-list-info-content-text").show(),e.find(".ps-list-info-content-error").hide(),"checkbox"===g?(b=e.data("original-value").split(","),f=e.find("input[type=checkbox]"),f.each(function(){this.checked=b.indexOf(this.value)>-1})):"radio"===g?(b=e.data("original-value"),f=e.find("input[type=radio]"),f.each(function(){this.checked=this.value===b})):f.hasClass("datepicker")?(f.data("value",e.data("original-value")),f.val(e.data("original-formatted"))):f.val(e.data("original-value")),this.field_changed_list&&this.field_changed_list.length&&(c=this.field_changed_list.indexOf(h))>-1&&this.field_changed_list.splice(c,1),!1},PsProfile.prototype.save_field=function(a){var b,c,d,e=jQuery(a),f=e.closest(".ps-list-info-content").closest("li"),g=f.find("input[type=text],input[type=checkbox],input[type=radio],textarea,select"),h=f.find("button"),i=f.find(".ps-list-info-content-data"),j=(g.attr("type")||"").toLowerCase(),k=g.data("id");"checkbox"===j?(b=g.filter(":checked").map(function(){return this.value}),b=jQuery.makeArray(b),b=JSON.stringify(b)):b="radio"===j?g.filter(":checked").val():g.hasClass("datepicker")?g.data("value"):ps_observer.apply_filters("profile_field_save",g.val(),g),c={user_id:peepsodata.currentuserid,view_user_id:peepsodata.userid,id:k,value:b},this.save_field_saving=!0,this.change_beforeunload(),g.attr("disabled","disabled"),h.attr("disabled","disabled"),e.find("img").show();var l=this;return $PeepSo.postJson("profilefieldsajax.save",c,function(a){var b,c=0;if(e.find("img").hide(),g.removeAttr("disabled"),h.removeAttr("disabled"),l.save_field_saving=!1,a.success)b=a.data||{},f.find(".ps-list-info-content-form").hide(),f.find(".ps-list-info-content-text").show(),f.find(".ps-list-info-content-error").hide(),void 0!=b.display_value?i.html(b.display_value):"select"===g.prop("tagName").toLowerCase()?i.html(g.find("option:selected").text()):i.html(g.val()),void 0!==b.profile_completeness&&(+b.profile_completeness>=100?(c++,jQuery(".ps-completeness-status").hide(),jQuery(".ps-completeness-bar").hide()):(jQuery(".ps-completeness-status").html(b.profile_completeness_message).show(),jQuery(".ps-completeness-bar").show().children("span").css({width:+b.profile_completeness+"%"}))),void 0!==b.missing_required&&(+b.missing_required<=0?(c++,jQuery(".ps-missing-required-message").hide()):jQuery(".ps-missing-required-message").html(b.missing_required_message).show()),c>=2?jQuery(".ps-completeness-info").hide():jQuery(".ps-completeness-info").show(),l.field_changed_list&&l.field_changed_list.length&&(d=l.field_changed_list.indexOf(k))>-1&&l.field_changed_list.splice(d,1),f.addClass("ps-list-info-success"),setTimeout(function(){f.removeClass("ps-list-info-success")},1e3);else{var j,m,n=f.find(".ps-list-info-content-form"),o=[];if(n.find(".ps-js-validation").removeClass("ps-alert-danger"),a.errors[0])for(j in a.errors[0])m=n.find(".ps-js-validation-"+j),m.length?m.addClass("ps-alert-danger"):o.push(a.errors[0][j]);m=n.find(".ps-list-info-content-error").hide(),o.length&&(o=o.join("<br>"),m.html(o).show()),f.addClass("ps-list-info-error"),setTimeout(function(){f.removeClass("ps-list-info-error")},1e3)}}),!1},PsProfile.prototype.field_keydown=function(a,b){return 13!==b.keyCode||(setTimeout(function(){jQuery(a).closest(".ps-list-info-content").find(".ps-js-btn-save").trigger("click")},1),!1)},PsProfile.prototype.field_changed=function(a,b){var c=jQuery(a).data("id");return this.field_changed_list||(this.field_changed_list=[]),-1===this.field_changed_list.indexOf(c)&&this.field_changed_list.push(c),this.change_beforeunload(),!0},PsProfile.prototype.change_beforeunload=function(){if(!this.onbeforeunload_changed){var a=this;this.onbeforeunload_changed=window.onbeforeunload||function(){},window.onbeforeunload=function(){return a.save_field_saving?peepsodata.profile_saving_notice||"The system is currently saving your changes.":a.field_changed_list.length?peepsodata.profile_unsaved_notice||"There are unsaved changes on this page.":void 0}}},PsProfile.prototype.change_privacy=function(a){var b=jQuery(a),c=b.closest(".ps-js-dropdown"),d=c.find("input[type=hidden]"),e=c.find("button.ps-dropdown-toggle"),f=b.data("option-value"),g=d.data("id"),h=d.val(),i={10:"ps-icon-globe",20:"ps-icon-users",30:"ps-icon-user2",40:"ps-icon-lock"},j={user_id:peepsodata.currentuserid,view_user_id:peepsodata.userid,id:g,acc:f};e.find("i").attr("class",i[f]),$PeepSo.postJson("profilefieldsajax.save_acc",j,function(a){a.success?(d.val(f),e.find(".ps-privacy-title").html(b.find("span").html())):e.find("i").attr("class",i[h])})},PsProfile.prototype.use_gravatar=function(){var a=this;$PeepSo.postJson("profile.use_gravatar",{},function(b){if(b.success){var c=jQuery("#dialog-upload-avatar-content",jQuery(b.data.html)),d=jQuery("#dialog-upload-avatar .dialog-action").html(),e=(Math.random(),b.data.image_url);e=e+(e.indexOf("?")>=0?"&rand=":"?rand=")+Math.random(),jQuery(".js-focus-avatar img",c).attr("src",e),jQuery(".imagePreview img",c).attr("src",e),jQuery(".imagePreview",c).after('<input type="hidden" name="is_tmp" value="1"/>'),jQuery(".ps-js-has-avatar",c).show(),jQuery(".ps-js-no-avatar",c).hide(),jQuery(".ps-js-crop-avatar",c).hide(),pswindow.set_content(c),pswindow.set_actions(d),jQuery("#imagePreview img").one("load",function(){pswindow.refresh()}),a.init_avatar_fileupload(),jQuery("#ps-window button[name=rep_submit]").removeAttr("disabled").addClass("ps-btn-primary"),a.invalid_avatar_upload=!1,a.avatar_use_gravatar=!0}})},PsProfile.prototype.save_preference=function(a){var b=jQuery(a&&a.target?a.target:a),c=b.closest(".ps-form-controls").find(".ps-js-loading"),d={};d.user_id=peepsodata.currentuserid,d.view_user_id=peepsodata.userid,d.meta_key=b.attr("name"),d.value=b.is(":checkbox")?b[0].checked?1:0:b.val(),c.find("i").stop().hide(),c.find("img").show(),$PeepSo.postJson("profilepreferencesajax.save",d,function(a){c.find("img").hide(),c.find("i").show().delay(800).fadeOut(),a.success})},PsProfile.prototype.save_notification=function(a){var b=jQuery(a&&a.target?a.target:a),c=b.closest(".ps-form-controls").find(".ps-js-loading"),d={};d.user_id=peepsodata.currentuserid,d.view_user_id=peepsodata.userid,d.fieldname=b.attr("name"),d.value=b.is(":checkbox")?b[0].checked?1:0:b.val(),c.find("i").stop().hide(),c.find("img").show(),$PeepSo.postJson("profilepreferencesajax.save_notifications",d,function(a){c.find("img").hide(),c.find("i").show().delay(800).fadeOut(),a.success})},jQuery(document).ready(function(){profile.init()});